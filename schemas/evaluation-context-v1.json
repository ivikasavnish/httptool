{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://httptool.dev/schemas/evaluation-context/v1",
  "title": "Evaluation Context v1",
  "description": "Input contract for polyglot evaluators",
  "type": "object",
  "required": ["ir", "request", "response"],
  "properties": {
    "ir": {
      "description": "Original IR that generated this request",
      "$ref": "https://httptool.dev/schemas/ir/v1"
    },
    "request": {
      "type": "object",
      "required": ["method", "url", "headers"],
      "properties": {
        "method": {"type": "string"},
        "url": {"type": "string"},
        "headers": {
          "type": "object",
          "additionalProperties": {"type": "string"}
        },
        "body": {
          "description": "Actual request body sent",
          "oneOf": [
            {"type": "string"},
            {"type": "object"},
            {"type": "null"}
          ]
        }
      }
    },
    "response": {
      "type": "object",
      "required": ["status", "headers", "latency_ms"],
      "properties": {
        "status": {
          "type": "integer",
          "minimum": 100,
          "maximum": 599
        },
        "headers": {
          "type": "object",
          "additionalProperties": {"type": "string"}
        },
        "body": {
          "description": "Response body (parsed if JSON, otherwise string)",
          "oneOf": [
            {"type": "string"},
            {"type": "object"},
            {"type": "array"},
            {"type": "null"}
          ]
        },
        "latency_ms": {
          "type": "number",
          "minimum": 0
        },
        "size_bytes": {
          "type": "integer",
          "minimum": 0
        },
        "error": {
          "type": "string",
          "description": "Error message if request failed"
        }
      }
    },
    "vars": {
      "type": "object",
      "additionalProperties": true,
      "description": "Execution context variables",
      "properties": {
        "attempt": {
          "type": "integer",
          "minimum": 1,
          "description": "Current retry attempt number"
        },
        "env": {
          "type": "string",
          "description": "Execution environment"
        }
      }
    }
  }
}
